<!DOCTYPE html>

<html style="height: 100%" >
<head>
    <title>Chinese Diaspora</title>
    <meta charset="UTF-8">
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5.3.2/dist/echarts.min.js"></script>
    <script charset="utf-8" src="https://d3js.org/d3.v4.min.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js"></script>

    <!-- <link href='style.css' rel='stylesheet' /> -->
    <!-- <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style> -->

</head>

<body style = "height: 100%; margin: 0">

    <div id='map'></div>

    <div id="pagecontent">
       
        <p><select id="Options">
            <option hidden>Change option Here:</option>
            <option value="mapOption">map</option>
            <option value="barOption">bar chart</option>
            </select>
        </p>
    
    </div>

    

    <div id="container" style="height: 100%"></div>


    <script type="text/javascript">

        var dom = document.getElementById("container");
        var myChart = echarts.init(dom);
        var app = {};
        var option;

        
        myChart.showLoading();
        $.get('Data/worldgeo.json', function (worldJson) {
            myChart.hideLoading();
            echarts.registerMap('worldmap', worldJson);


            d3.csv('Data/overseas_chinese_country_pop.csv', function(countrydata){
                console.log(countrydata)
                

                countrydata.sort(function (a, b) {
                return a.value - b.value;
                });
                var topValue = countrydata.slice(58,79);



                
            var citydata = [
                { name:	"Singapore",	value:	2960.14	},
                { name:	"Bangkok",	value:	7221	},
                { name:	"Kuala_Lumpur",	value:	2189.2	},
                { name:	"Johor_Bahru",	value:	1078.8	},
                { name:	"George_Town",	value:	685.8	},
                { name:	"Ipoh",	value:	703.1	},
                { name:	"Jakarta",	value:	579.612	},
                { name:	"Surabaya",	value:	147.047	},
                { name:	"Medan",	value:	201.519	},
                { name:	"Pontianak",	value:	104.325	},
                { name:	"Bandung",	value:	83.32	},
                { name:	"Yangon",	value:	1287.156	},
                { name:	"Manila",	value:	500	},
                { name:	"Ho_Chi_Minh_City",	value:	992.6	},
                { name:	"Tokyo",	value:	197.51	},
                { name:	"Kanagawa",	value:	64.83	},
                { name:	"Saitama",	value:	62.948	},
                { name:	"Osaka",	value:	674.87	},
                { name:	"Vientiane",	value:	176.49	},
                { name:	"Phnom_Penh",	value:	147.02	},
                { name:	"Calcutta",	value:	129.74	},
                { name:	"Dubai",	value:	109.5	},
                { name:	"Ansan",	value:	1075.566	},
                { name:	"New_York",	value:	865	},
                { name:	"Los_Angeles",	value:	678	},
                { name:	"San_Francisco",	value:	582	},
                { name:	"San_Jose",	value:	239	},
                { name:	"Boston",	value:	174	},
                { name:	"Seattle",	value:	166	},
                { name:	"Washington",	value:	135	},
                { name:	"Chicago",	value:	135	},
                { name:	"Honolulu",	value:	117	},
                { name:	"Houston",	value:	111	},
                { name:	"Toronto",	value:	631.05	},
                { name:	"Vancouver",	value:	474.655	},
                { name:	"Calgary",	value:	89.675	},
                { name:	"Montreal",	value:	89.4	},
                { name:	"Lima",	value:	14.223	},
                { name:	"São_Paulo",	value:	200	},
                { name:	"Panama_City",	value:	135.96	},
                { name:	"Moscow",	value:	400	},
                { name:	"Paris",	value:	600	},
                { name:	"London",	value:	44	},
                { name:	"Manchester",	value:	13	},
                { name:	"Birmingham",	value:	12	},
                { name:	"Milan",	value:	18.918	},
                { name:	"Rome",	value:	12.013	},
                { name:	"Prato",	value:	11.882	},
                { name:	"Barcelona",	value:	120	},
                { name:	"Madrid",	value:	40.75	},
                { name:	"Sydney",	value:	487.976	},
                { name:	"Melbourne",	value:	356.324	},
                { name:	"Brisbane",	value:	99.593	},
                { name:	"Perth",	value:	99.229	},
                { name:	"Adelaide",	value:	50.216	},
                { name:	"Canberra",	value:	22.445	},
                { name:	"Auckland",	value:	171.309	},
                { name:	"Canterbury",	value:	21.516	},
                { name:	"Wellington",	value:	21.192	},
                { name:	"Waikato",	value:	12.084	},
            ];

            var geoCoordMap = {
                Singapore	: [	103.8407863	,	1.2805179	],
                Bangkok	: [	100.5107441	,	13.7373979	],
                Kuala_Lumpur	: [	101.6936373	,	3.1445387	],
                Johor_Bahru	: [	103.7605655	,	1.4578971	],
                George_Town	: [	100.3320309	,	5.4178117	],
                Ipoh	: [	101.110048	,	4.5712252	],
                Jakarta	: [	106.8112461	,	-6.1446546	],
                Surabaya	: [	112.7389142	,	-7.2374041	],
                Medan	: [	98.6716919	,	3.5926572	],
                Pontianak	: [	109.3427661	,	-0.0305307	],
                Bandung	: [	107.5997541	,	-6.9217892	],
                Yangon	: [	96.1498833	,	16.7733311	],
                Manila	: [	120.9710572	,	14.6011743	],
                Ho_Chi_Minh_City	: [	106.629662	,	10.823099	],
                Tokyo	: [	139.691711	,	35.689487	],
                Kanagawa	: [	130.408676	,	33.167519	],
                Saitama	: [	139.648849	,	35.856998	],
                Osaka	: [	135.502167	,	34.693737	],
                Vientiane	: [	102.6133707	,	17.9640988	],
                Phnom_Penh	: [	104.9224426	,	11.568271	],
                Calcutta	: [	88.3638815	,	22.5726723	],
                Dubai	: [	55.2924914	,	25.2653471	],
                Ansan	: [	126.8309	,	37.3219	],
                New_York	: [	-74.0056357	,	40.7160814	],
                Los_Angeles	: [	-118.2491091	,	34.0671948	],
                San_Francisco	: [	-122.4115197	,	37.7940949	],
                San_Jose	: [	-121.8914769	,	37.3324873	],
                Boston	: [	-71.065117	,	42.3497472	],
                Seattle	: [	-122.3246248	,	47.5988346	],
                Washington	: [	-77.0220557	,	38.9003471	],
                Chicago	: [	-87.6409851	,	41.852461	],
                Honolulu	: [	-157.8747863	,	21.3161566	],
                Houston	: [	-95.5544042	,	29.7043423	],
                Toronto	: [	-79.4019022	,	43.6533133	],
                Vancouver	: [	-123.1096408	,	49.2805034	],
                Calgary	: [	-114.0714161	,	51.0512706	],
                Montreal	: [	-73.5626265	,	45.5070724	],
                Lima	: [	-77.0428	,	-12.0464	],
                São_Paulo	: [	-46.6396	,	-23.5558	],
                Panama_City	: [	-79.5199	,	8.9824	],
                Moscow	: [	37.6173	,	55.7558	],
                Paris	: [	2.3522	,	48.8566	],
                London	: [	0.1276	,	51.5072	],
                Manchester	: [	2.2426	,	53.4808	],
                Birmingham	: [	1.8904	,	52.4862	],
                Milan	: [	9.19	,	45.4642	],
                Rome	: [	12.4964	,	41.9028	],
                Prato	: [	11.1022	,	43.8777	],
                Barcelona	: [	2.1686	,	41.3874	],
                Madrid	: [	3.7038	,	40.4168	],
                Sydney	: [	151.2093	,	-33.8688	],
                Melbourne	: [	144.9631	,	-37.8136	],
                Brisbane	: [	153.026	,	-27.4705	],
                Perth	: [	115.8613	,	-31.9523	],
                Adelaide	: [	138.6007	,	-34.9285	],
                Canberra	: [	149.131	,	-35.2802	],
                Auckland	: [	174.7645	,	-36.8509	],
                Canterbury	: [	43.7542	,	-171.1637	],
                Wellington	: [	174.7787	,	-41.2924	],
                Waikato	: [	175.0233	,	-37.6191	],
            };

                var convertData = function (city) {
                    var res = [];
                    for (var i = 0; i < citydata.length; i++) {
                        var geoCoord = geoCoordMap[citydata[i].name];
                        if (geoCoord) {
                        res.push({
                            name: citydata[i].name,
                            value: geoCoord.concat(citydata[i].value)
                        });
                        }
                    }
                    return res;
                };


                const cityOption = {
                    tooltip: {
                        trigger: 'item',
                    },

                    geo: {
                        show: false,
                        map: 'worldmap',
                        roam: true
                    },

                    series: [{
                        symbol: 'pin',
                        name: 'citypop',
                        type: 'scatter',
                        coordinateSystem: 'geo',
                        symbolSize: [20,20],
                        // symbolSize: function (val) {
                        //     return (val[2] / 100) ;
                        // },
                        data: convertData(citydata),
                        encode: {
                            value: 2
                        },
                        animation: true,
                        universalTransition: true,
                        tooltip: {
                            backgroundColor: 'rgb(0,0,0)',
                            textStyle: {
                                color: '#fff'
                            },
                            formatter : function (params) {
                                var values = (params.value + '').split(',');
                                var names = (params.name + '').split(',');

                                name = names[0]  
                                value = values[2]
                                return name + ': ' + value;
                            }
                        },

                    }],
                };

                // const citybarOption = {
                //     xAxis: {
                //         type: 'category',
                //         data: citydata.name,
                //     },
                //     yAxis: {
                //         type: citydata.value,
                //     },
                //     series: [
                //         {
                //         data: citydata.value,
                //         type: 'bar',
                //         center: [0,100],
                //         }
                //     ]
                // };

                console.log(citydata)

                const mapOption = {
                    title: {
                        text: 'Contemporary Overseas Chinese Diaspora',
                        subtext: '(Per thousands people)',
                        subtextStyle: {
                            fontSize: 18,
                        },
                        // sublink: 'http://www.pm25.in',
                        textStyle: {
                            fontStyle: 'normal',
                            fontSize: 25
                        },
                        left: 'center',
                    },
                    tooltip: {
                        formatter: '{b}, {c}' 
                    },
                    // daraZoom: 'zoomlock',
                    // [{
                    //    inside: 'zoomlock'
                    // }],
                    center: [0,0],
                    scaleLimit: 'max',
                    zoom: 100,
                    visualMap: {
                        show: true,
                        left: 'right',
                        min: 5,
                        max: 8100,
                        inRange: {
                            color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026'],
                            // colorAlpha: 0,
                            // opacity: 0
                        },
                        text: ['High', 'Low'],
                        calculable: true,
                        
                    },
                    series: [{
                        id: 'population',
                        type: 'map',
                        roam: true,
                        map: 'worldmap',
                        animation: true,
                        animationDurationUpdate: 1000,
                        universalTransition: true,
                        zoom: true,
                        data: countrydata
                    }]              
                };

                
                const barOption = {
                    title: {
                        text: 'Top 20 Coutries of Chinese Diaspora',
                        subtext: '(Per thousands people)',
                        subtextStyle: {
                            fontSize: 18,
                        },
                        // sublink: 'http://www.pm25.in',
                        textStyle: {
                            fontStyle: 'normal',
                            fontSize: 25
                        },
                        left: 'center'
                    },
                    xAxis: {
                    type: 'value'
                    },
                    
                    yAxis: {
                    type: 'category',
                    axisLabel: {
                        rotate: 0
                    },

                    data: topValue.map(function (item) {
                        // console.log()
                        return item.name;
                    })
                    },
                    animation: true,
                    animationDurationUpdate: 1000,
                    series: {
                    type: 'bar',
                    id: 'population',
                    data: topValue.map(function (item) {
                        // console.log(topValue);
                        return item.value;
                    }),
                    universalTransition: true
                    }
                };

                myChart.setOption(cityOption);
                myChart.setOption(mapOption);
                // myChart.setOption(citybarOption);


                trigger = 1
                document.getElementById("Options").onchange = function() {
                    if (trigger == 1) {
                        myChart.setOption(barOption);

                        const mapOption = {
                            visualMap:{
                                show: false
                            }
                        };
                        myChart.setOption(mapOption);

                        const cityOption = {
                            series:{
                                symbol: 'none'
                            }
                        };
                        myChart.setOption(cityOption);

                        trigger = 0;
                        console.log(trigger)
                    } else {
                        myChart.setOption(mapOption);
                        
                        const barOption = {
                            yAxis: [{
                                show: false,
                                type: "log",
                            }]
                        };
                        myChart.setOption(barOption);

                        const cityOption = {
                            series:{
                                symbol: 'pin'
                            },
                            
                        };
                        myChart.setOption(cityOption);
                        trigger = 1
                        console.log(trigger)
                    }
                }  


            });

                if (option && typeof option === 'object') {
                    myChart.setOption(option);
                };













        })

    </script>
        

    <!-- <script>

        mapboxgl.accessToken = 'pk.eyJ1IjoiemhvbmdoYW9saSIsImEiOiJja3lsaW45NWwxY3d4Mm9xbzBldzR2bGZnIn0.98_3F0MM5qTBr5OKtOUASw';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/zhonghaoli/cl33gsca0001k14qcw8z0v3i0',
            center: [10, 35],
            zoom: 1.5
        });
       

        map.on('load', function () {

            map.addLayer({
                'id': 'CountryPop',
                'type': 'fill',
                'source': {
                    'type': 'vector',
                    'url': 'mapbox://zhonghaoli.cutvbpd8'
                },
                'source-layer': 'overseas_chinese_country_pop-bx7pmg',
                'layout': {},
                'paint': {
                    'fill-color': '#888788',
                    'fill-opacity': 0.5
                    // [
                        // 'case',
                        // ['boolean', ['feature-state', 'hover'], false],
                        // 0.6,
                        // 0
                    // ]
                }
            })


            map.addLayer({
            
            id: 'CityPop',
            type: 'circle',
            source: {
                type: 'vector',
                url: 'mapbox://zhonghaoli.8tyzv48z'
            },
            'source-layer': 'overseas_chinese_city_pop-9c5l92',
            'layout': {
                visibility: 'visible'
            },
            // minzoom: 2,
            paint: {
                'circle-color': '#F0401A',
                'circle-opacity': 0.75,
                // 'circle-stroke-width': 1,
                // 'circle-stroke-color': '#457B9D',
                // 'circle-stroke-opacity': 0.6,
                'circle-color': { //set a gradiant color, very subtle visual change
                    property: 'Population',
                    stops: [
                        // [1000, "#A9D6E5"],
                        // [1200, "#A9D6E5"],
                        // [1400, "#61A5C2"],
                        [1600, "#468FAF"],
                        // [1800, "#2C7DA0"],
                        // [2000, "#2A6F97"],
                        // [2200, "#014F86"],
                        // [2400, "#01497C"],
                        // [2600, "#013A63"],
                        // [2800, "#012A4A"],
                    ]
                },
                //'circle-color': '#ced4da', - other color
                
                'circle-radius': {
                    property: 'Population',
                    
                    stops: [
                        [{zoom: 1.5, value: 0}, 5],
                        [{zoom: 1.5, value: 1000}, 10],
                        [{zoom: 1.5, value: 3000}, 30],
                        [{zoom: 1.5, value: 7000}, 40],
                        ]
                    }
                }

            });

            





        })
            
        
                    

    </script> -->

</body>

</html>


